import{e as a,h as e,j as t,k as i,n as s,E as o,C as l,s as r,l as n,c,w as d,i as h,o as p,a as u,f as m,r as y,F as g,A as w,b as k,g as b,S as f,G as _,t as v}from"./index-BeTsOSG5.js";import{_ as T}from"./uni-icons.29EWF_Z6.js";import{r as C}from"./uni-app.es.0hj2hPwg.js";import{_ as L}from"./uni-search-bar.DR1kaZKb.js";import{_ as j}from"./bannerScript.DVkyCr0d.js";import{s as D}from"./uni-status-bar.BWb8fgD4.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-dateformat.D8YMlrQf.js";import"./store.D6I9T0aE.js";const S=a.database(),R=S.command;R.aggregate;const z=F({components:{statusBar:D},computed:{inputPlaceholder:a=>"en"==e("CURRENT_LANG")?"Please enter the search content":"输入搜索词或完整网址",colList(){return[S.collection("web-script").where(this.where).field('id,name,description,"update-id",host,publisher,publish_date,day,total,user_id,create_date,version,show').getTemp(),S.collection("uni-id-users").field("_id,nickname").getTemp()]}},data:()=>({keyword:"1",dataList:[],pagination:{skip:0,limit:20,total:0},loadingType:"more",currentRequest:null,tabs:[{label:"今日安装",value:"today"},{label:"近期热门",value:"hot"},{label:"最近更新",value:"latest"}],activeTab:"today"}),watch:{keyword(a,e){this.handleSearch(a)}},async onReady(){this.listHight="auto"},async onShow(){this.keyword=t().globalData.searchText,this.keyword&&(this.activeTab="today")},onUnload(){this.dataList=[]},methods:{switchTab(a){this.activeTab=a,this.loadData(!0)},searchClick(a){i(),s({url:"/pages/list/search/search",animationType:"fade-in"})},async handleSearch(){this.pagination.skip=0,await this.loadData(!0)},async loadData(e=!1){if("loading"!==this.loadingType){this.loadingType="loading";try{e&&(this.pagination.skip=0,this.dataList=[]);try{var t,i={name:!0,description:!0,publisher:!0,version:!0,create_date:!0,publish_date:!0,id:!0,"update-id":!0,host:!0,day:!0,total:!0,"name:zh":!0,"name:zh-CN":!0,"description:zh":!0,"description:zh-CN":!0};if(this.keyword.trim()){var s={type:"getList",data:{skip:this.pagination.skip,limit:this.pagination.limit,show:2,search:this.keyword.trim(),type:this.activeTab}};const e=await a.callFunction({name:"web-scripts",data:s});var n=await S.collection("web-script").where({_id:R.in(e.result.data.map((a=>a._id)))}).field(i).get();t=e.result.data.map((a=>n.result.data.find((e=>e._id==a._id)))).filter((a=>a))}else{if("latest"!=this.activeTab)t=(n=await S.collection("web-script").where({show:2}).orderBy("day","desc").field(i).skip(this.pagination.skip).get()).result.data;else t=(n=await S.collection("web-script").where({show:2}).orderBy("create_date","desc").field(i).skip(this.pagination.skip).get()).result.data}this.dataList=e?t:[...this.dataList,...t],this.pagination.skip=this.pagination.skip+t.length,this.loadingType=t.length<this.pagination.limit?"noMore":"more",o()}catch(c){this.loadingType="more",l({title:"加载失败",icon:"none"}),o()}r()}catch(c){"AbortError"!==c.name&&(console.error(c),this.loadingType="error")}}},refresh(){this.loadData().then((a=>{r(),console.log("end")}))},loadMore(){this.loadData()},onqueryerror(a){console.error(a)},onpullingdown(a){console.log(a),this.showRefresh=!0,a.pullingDistance>100&&this.refresh()}},onPullDownRefresh(){this.refresh()},onReachBottom(){this.loadMore()}},[["render",function(a,e,t,i,s,o){const l=C(n("uni-icons"),T),r=C(n("uni-search-bar"),L),D=h,F=C(n("bannerScript"),j),S=b,R=f;return p(),c(D,{class:"page-container"},{default:d((()=>[u(D,{class:"search-container",onClick:o.searchClick},{default:d((()=>[u(r,{modelValue:s.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>s.keyword=a),radius:"30",bgColor:"#FFFFFF",placeholderColor:"#A0AEC0",cancelButton:"none",placeholder:o.inputPlaceholder},{searchIcon:d((()=>[u(l,{type:"search",size:"18",color:"#718096"})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["onClick"]),this.keyword?w("",!0):(p(),c(D,{key:0,class:"nav-container"},{default:d((()=>[(p(!0),m(g,null,y(s.tabs,(a=>(p(),c(D,{key:a.value,class:_(["nav-item",{active:s.activeTab===a.value}]),onClick:e=>o.switchTab(a.value)},{default:d((()=>[k(v(a.label)+" ",1),s.activeTab===a.value?(p(),c(D,{key:0,class:"active-indicator"})):w("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})),u(R,{onScrolltolower:o.loadMore,"scroll-y":!0},{default:d((()=>[s.dataList.length?(p(!0),m(g,{key:0},y(s.dataList,((a,e)=>(p(),c(F,{key:a._id,item:a},null,8,["item"])))),128)):w("",!0),u(D,{class:"loading-state"},{default:d((()=>["loading"===s.loadingType?(p(),c(D,{key:0,class:"loading-indicator"})):"noMore"===s.loadingType?(p(),m(g,{key:1},[u(l,{type:"checkmarkempty",size:"24",color:"#718096"}),u(S,{class:"tip-text"},{default:d((()=>[k("已经到底啦")])),_:1})],64)):w("",!0)])),_:1})])),_:1},8,["onScrolltolower"])])),_:1})}],["__scopeId","data-v-4e8bf1e5"]]);export{z as default};
