import{e,n as t,af as l,l as s,o as a,c as o,w as i,a as c,b as d,t as n,G as r,A as u,ab as f,g as m,i as h,M as _,ae as p}from"./index-BeTsOSG5.js";import{_ as g}from"./uni-dateformat.D8YMlrQf.js";import{r as y}from"./uni-app.es.0hj2hPwg.js";import{_ as b}from"./uni-icons.29EWF_Z6.js";import{s as k}from"./store.D6I9T0aE.js";import{_ as v}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=e.database();I.command;const C=v({data:()=>({showRefresh:!1,state:0,installState:!1,userInfo:null}),computed:{originClass(){var e,t;return(null==(e=this.item.host)?void 0:e.includes("greasyfork"))?"greasyfork":(null==(t=this.item.host)?void 0:t.includes("scriptcat"))?"scriptcat":"soujiaoben"},originText(){return{greasyfork:"海外源",scriptcat:"社区源",soujiaoben:"本站源"}[this.originClass]},getSourceIcon(){return{greasyfork:"flag-filled",scriptcat:"community-filled",soujiaoben:"home-filled"}[this.originClass]},getSourceText(){return{greasyfork:"greasyfork",scriptcat:"scriptcat",soujiaoben:"soujiaoben"}[this.originClass]}},mounted(){this.userInfo=k.userInfo},methods:{handleSortInput(){this.$emit("sort")},async delCollect(e){console.log("从当前合集中删除",this.collect_id),await I.collection("web-script-collection").where({id:e.id,host:e.host,user_id:this.userInfo._id,collect_id:this.collect._id}).remove(),console.log("删除成功"),this.$emit("refresh")},addCollect(){t({url:"/pages/web-like-collection/list?id="+this.item.id+"&host="+this.item.host})},install(){var t="https://env-00jxt5o5005s.dev-hz.cloudbasefunction.cn/scripts/";t=(t=t+this.item.host+"/")+this.item.id+"/",2!=this.item.show&&(t=t+this.item["update-id"]+"/"),t+="install.user.js",window.open(t),this.installState||(this.installState=!0,l().then((t=>{e.callFunction({name:"web-scripts",data:{type:"install",data:{device_id:t.deviceId,host:this.item.host,id:this.item.id}},success:e=>{},fail:e=>{}})})))},onpullingdown({pullingDistance:e,viewHeight:t}){this.state=e<t?0:1},golast(e){if(this.goto||e){var l="/pages/list/detail?id="+this.item.id+"&host="+this.item.host;t({url:l})}},refresh(){this.showRefresh=!0,this.state=2,this.$emit("refresh")}},watch:{},props:{item:{type:Object,default:()=>!1},goto:{type:Boolean,default:()=>!0},collect:{type:Object,default:()=>null}}},[["render",function(e,t,l,k,v,I){const C=m,w=h,j=y(s("uni-dateformat"),g),x=y(s("uni-icons"),b),z=_,S=p;return a(),o(w,{class:"card-container",onClick:t[6]||(t[6]=e=>I.golast())},{default:i((()=>[c(w,{class:r(["source-badge",I.originClass])},{default:i((()=>[c(C,null,{default:i((()=>[d(n(I.getSourceText),1)])),_:1})])),_:1},8,["class"]),c(w,{class:"card-header"},{default:i((()=>[c(w,{class:"title-container"},{default:i((()=>[c(C,{class:"card-title"},{default:i((()=>[d(n(l.item["name:zh-CN"]||l.item["name:zh"]||l.item.name),1)])),_:1})])),_:1}),c(w,{class:"card-description"},{default:i((()=>[d(n(l.item["description:zh-CN"]||l.item["description:zh"]||l.item.description||"暂无脚本描述"),1)])),_:1})])),_:1}),c(w,{class:"card-details"},{default:i((()=>[c(w,{class:"detail-item"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[d("👤 作者")])),_:1}),c(C,{class:"value"},{default:i((()=>[d(n(l.item.publisher||"匿名开发者"),1)])),_:1})])),_:1}),c(w,{class:"detail-item"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[d("📆 今日安装")])),_:1}),c(C,{class:"value"},{default:i((()=>[d(n(l.item.day||0),1)])),_:1})])),_:1}),c(w,{class:"detail-item"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[d("🔄 最新版本")])),_:1}),c(C,{class:"value"},{default:i((()=>[d(n(l.item.version||"1.0.0"),1)])),_:1})])),_:1}),c(w,{class:"detail-item"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[d("⏰ 更新时间")])),_:1}),c(j,{class:"value",date:l.item.create_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]},null,8,["date"])])),_:1}),c(w,{class:"detail-item"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[d("📅 创建时间")])),_:1}),c(j,{class:"value",date:l.item.publish_date,format:"yyyy-MM-dd hh:mm",threshold:[6e4,2592e6]},null,8,["date"])])),_:1}),c(w,{class:"detail-item"},{default:i((()=>[c(C,{class:"label"},{default:i((()=>[d("📊 总计安装")])),_:1}),c(C,{class:"value"},{default:i((()=>[d(n(l.item.total||0),1)])),_:1})])),_:1})])),_:1}),l.goto?u("",!0):(a(),o(w,{key:0,class:"rating-container"},{default:i((()=>[c(C,{class:"score positive"},{default:i((()=>[d("★ "+n(l.item.good||0)+" 好评",1)])),_:1}),c(C,{class:"score neutral"},{default:i((()=>[d("★ "+n(l.item.neutral||0)+" 中评",1)])),_:1}),c(C,{class:"score negative"},{default:i((()=>[d("★ "+n(l.item.bad||0)+" 差评",1)])),_:1})])),_:1})),v.userInfo&&v.userInfo._id&&(!l.goto&&!l.collect||l.collect&&l.collect.user_id==v.userInfo._id)?(a(),o(w,{key:1,class:"action-buttons"},{default:i((()=>[l.goto||l.collect?u("",!0):(a(),o(w,{key:0,class:"install-btn",onClick:f(I.addCollect,["stop"])},{default:i((()=>[c(x,{type:"download-filled",size:"16",color:"#fff"}),c(C,null,{default:i((()=>[d("加入收藏")])),_:1})])),_:1},8,["onClick"])),l.collect&&l.collect.user_id==v.userInfo._id?(a(),o(w,{key:1,class:"sort-container"},{default:i((()=>[c(w,{class:"sort-control",onClick:t[1]||(t[1]=f((()=>{}),["stop"]))},{default:i((()=>[c(C,{class:"sort-label"},{default:i((()=>[d("排序权重")])),_:1}),c(z,{modelValue:l.item.sort,"onUpdate:modelValue":t[0]||(t[0]=e=>l.item.sort=e),placeholder:"0",class:"sort-input",type:"number",maxlength:"5",onInput:I.handleSortInput},null,8,["modelValue","onInput"])])),_:1}),c(w,{class:"delete-btn",onClick:t[2]||(t[2]=f((e=>I.delCollect(l.item)),["stop"]))},{default:i((()=>[c(x,{type:"trash",size:"14",color:"#f56c6c"}),c(C,null,{default:i((()=>[d("移出合集")])),_:1})])),_:1})])),_:1})):u("",!0)])),_:1})):u("",!0),l.collect&&l.item.comment||v.userInfo&&l.collect&&l.collect.user_id==v.userInfo._id?(a(),o(w,{key:2,class:"action-buttons"},{default:i((()=>[c(w,{class:"sort-container"},{default:i((()=>[c(w,{class:"sort-control",onClick:t[4]||(t[4]=f((()=>{}),["stop"]))},{default:i((()=>[c(C,{class:"sort-label"},{default:i((()=>[d("评语")])),_:1}),v.userInfo&&l.collect&&l.collect.user_id==v.userInfo._id?(a(),o(S,{key:0,modelValue:l.item.comment,"onUpdate:modelValue":t[3]||(t[3]=e=>l.item.comment=e),placeholder:"",class:"sort-textarea",maxlength:"100",onInput:I.handleSortInput},null,8,["modelValue","onInput"])):l.item.comment?(a(),o(w,{key:1,class:"sort-label"},{default:i((()=>[d(n(l.item.comment),1)])),_:1})):u("",!0)])),_:1})])),_:1})])),_:1})):u("",!0),l.goto?u("",!0):(a(),o(w,{key:3,class:"action-buttons"},{default:i((()=>[c(w,{class:"install-btn",onClick:f(I.install,["stop"])},{default:i((()=>[c(x,{type:"download-filled",size:"16",color:"#fff"}),c(C,null,{default:i((()=>[d(n("立即安装"))])),_:1})])),_:1},8,["onClick"]),l.item.last?u("",!0):(a(),o(w,{key:0,class:"secondary-btn",onClick:t[5]||(t[5]=e=>I.golast(!0))},{default:i((()=>[c(x,{type:"forward",size:"14",color:"#4a5568"}),c(C,null,{default:i((()=>[d("查看最新版")])),_:1})])),_:1}))])),_:1}))])),_:1})}],["__scopeId","data-v-cee60842"]]);export{C as _};
