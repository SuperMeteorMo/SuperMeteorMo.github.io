import{g as a,h as e,j as t,k as i,n as o,s,l as r,c as n,w as l,i as d,o as c,a as h,e as p,r as u,F as m,A as g,b as y,f,S as k}from"./index-CsBabVVh.js";import{_ as w}from"./uni-icons.B8m2qatV.js";import{r as _}from"./uni-app.es.CHxFQLV4.js";import{_ as b}from"./uni-search-bar.BCRJnEv-.js";import{_ as T}from"./bannerScript.168__zWW.js";import{s as j}from"./uni-status-bar.BzlACZLp.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-dateformat.WzrDsZWn.js";const L=a.database(),D=L.command;D.aggregate;const F=C({components:{statusBar:j},computed:{inputPlaceholder:a=>"en"==e("CURRENT_LANG")?"Please enter the search content":"请输入搜索内容",colList(){return[L.collection("web-script").where(this.where).field('id,name,description,"update-id",host,publisher,publish_date,day,total,user_id,create_date,version,show').getTemp(),L.collection("uni-id-users").field("_id,nickname").getTemp()]}},data:()=>({keyword:"1",dataList:[],pagination:{skip:0,limit:20,total:0},loadingType:"more",currentRequest:null}),watch:{keyword(a,e){this.handleSearch(a)}},async onReady(){this.listHight="auto"},async onShow(){this.keyword=t().globalData.searchText,console.log("显示",this.keyword)},onUnload(){this.dataList=[]},methods:{searchClick(a){i(),o({url:"/pages/list/search/search",animationType:"fade-in"})},async handleSearch(){this.pagination.skip=0,await this.loadData(!0)},async loadData(e=!1){if("loading"!==this.loadingType){this.loadingType="loading";try{e&&(this.pagination.skip=0);const o=await a.callFunction({name:"scripts",data:{type:"getList",data:{skip:this.pagination.skip,limit:this.pagination.limit,show:2,search:this.keyword.trim()}}});var t=await L.collection("web-script").where({_id:D.in(o.result.data.map((a=>a._id)))}).field({name:!0,description:!0,publisher:!0,version:!0,create_date:!0,publish_date:!0,id:!0,"update-id":!0,host:!0}).get();console.log("结果",t,o);var i=o.result.data.map((a=>t.result.data.find((e=>e._id==a._id)))).filter((a=>a));this.dataList=e?i:[...this.dataList,...i],this.pagination.total=t.result.total,this.pagination.skip=this.pagination.skip+i.length,this.loadingType=i.length<this.pagination.limit?"noMore":"more",s()}catch(o){"AbortError"!==o.name&&(console.error(o),this.loadingType="error")}}},refresh(){this.loadData().then((a=>{s(),console.log("end")}))},loadMore(){this.loadData()},onqueryerror(a){console.error(a)},onpullingdown(a){console.log(a),this.showRefresh=!0,a.pullingDistance>100&&this.refresh()}},onPullDownRefresh(){this.refresh()},onReachBottom(){this.loadMore()}},[["render",function(a,e,t,i,o,s){const j=_(r("uni-icons"),w),C=_(r("uni-search-bar"),b),L=d,D=_(r("bannerScript"),T),F=f,S=k;return c(),n(L,{class:"page-container"},{default:l((()=>[h(L,{class:"search-container",onClick:s.searchClick},{default:l((()=>[h(C,{modelValue:o.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>o.keyword=a),radius:"30",bgColor:"#FFFFFF",placeholderColor:"#A0AEC0",cancelButton:"none",placeholder:s.inputPlaceholder},{searchIcon:l((()=>[h(j,{type:"search",size:"18",color:"#718096"})])),_:1},8,["modelValue","placeholder"])])),_:1},8,["onClick"]),h(S,{onScrolltolower:s.loadMore,"scroll-y":!0},{default:l((()=>[o.dataList.length?(c(!0),p(m,{key:0},u(o.dataList,((a,e)=>(c(),n(D,{key:a._id,item:a},null,8,["item"])))),128)):g("",!0),h(L,{class:"loading-state"},{default:l((()=>["loading"===o.loadingType?(c(),n(L,{key:0,class:"loading-indicator"})):"noMore"===o.loadingType?(c(),p(m,{key:1},[h(j,{type:"checkmarkempty",size:"24",color:"#718096"}),h(F,{class:"tip-text"},{default:l((()=>[y("已经到底啦")])),_:1})],64)):g("",!0)])),_:1})])),_:1},8,["onScrolltolower"])])),_:1})}],["__scopeId","data-v-73a901a0"]]);export{F as default};
